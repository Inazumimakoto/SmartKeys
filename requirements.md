# SmartKeys 要件 v0.2

## 概要
- iOSカスタムキーボード（ターゲット: `SmartKeysKeyboard`）
- QWERTY + ローマ字IME（`InputEngine.swift`）+ フリック拡張
- 予測変換は将来LLM接続を想定、現時点はローカルのみ

## 現状仕様（ベースライン）
- QWERTY配列、Shiftトグル、削除（長押しオートリピート）
- 文字キーの**上フリック=数字**、**下フリック=記号**（1段目のみ）
  - 上: `q→1, w→2, …, o→9, p→0`
  - 下: `q→!, w→@, e→#, r→$, t→%, y→^, u→&, i→*, o→(, p→)`
- レイアウト:
  - 2段目 `l` の右に **「ー」**
  - 最下段：**「、」 Space 「。」**
- ナビ系:
  - ←/→、行頭/行末移動
- スマート編集:
  - 数値の ±1（前後の連続数字トークンを検出して置換）
  - 時刻 `HH:MM` の ±1（カーソルがHHならHH、MMならMMのみ変更。MMは00↔59で巻き）
  - 曜日ローテーション（`月→火→…→日`）
- IME:
  - ローマ字→ひらがな（拗音・外来音・`wh`/`tw`/`dw` 等の拡張）
  - **`nn`→「ん」**の確実な1文字化
  - 促音（重子音）・小書き対応
  - 非英字入力前にバッファ確定
- 記号キー・フリック時は**ローマ字バッファを先に確定**してから挿入

## 非スコープ
- 署名・実機配布設定
- ネットワーク送信（フルアクセス前提の機能）
- 既存アプリ内UIの大改修

## 追加タスク（Codex向け）
1. **フリック拡張の2段目/3段目**  
   - 例: 2段目の上フリックで `- _ = + [ ] { }`、下フリックで句読点やクォート類…など配置案を`flick-map.json`等に切り出し可能に。
2. **フリック候補ポップアップ**  
   - フリック方向プレビュー（小さなガイド）をボタン上に表示。
3. **設定トグル**  
   - 上下フリックの割当入替、フリックしきい値、長押しリピート速度。
4. **変換テスト**  
   - `InputEngine` のローマ字→かなのユニットテスト（`konnichiha`, `ryokou`, `shinjuku`, `nn` ケースなど）。

## ビルド / 動作確認
- ビルド:  xcodebuild -scheme SmartKeys -destination 'platform=iOS Simulator,name=iPhone 17'
- 検証シナリオ:
- `konnichiha` → `こんにちは`
- `12:00` で MM 側 +1 → `12:01`、00で -1 → `12:59`（HHは変えない）
- `月` で +1 → `火`
- 1段目キーで上フリック/下フリックが期待通り入ること
- フリック前にローマ字バッファが確定されること（`ryo`途中でフリックしても崩れない）

## 受け入れ条件
- 既存挙動の回帰なし（`nn`→「ん」、カーソル位置保持など）
- 1段目フリック: 上=数字 / 下=記号 がすべて正しく挿入
- 時刻/曜日/数値のスマート編集が仕様通り
- ビルド成功し、シミュレータで手動検証が可能

## ディレクトリ
- `SmartKeysKeyboard/KeyboardViewController.swift`（UI/フリック・操作系）
- `SmartKeysKeyboard/InputEngine.swift`（ローマ字IMEコア）


